# Руководство по установке кластера ClickHouse
Практическое пошаговое руководство по развертыванию Вашего собственного кластера ClickHouse

# Архитектура
![clickhouse](https://github.com/user-attachments/assets/8d9c3a9c-0ba3-4f3f-afa5-c58df470bb59)

| Роль				| Это кто  			|Основная задача				| Порты				|
|-------------------|-------------------|-------------------------------|-------------------|
|ClickHouse Server	|Любая нода			|SQL, хранение, distributed		|9000 / 8123 / 9009	|
|Coordinator		|Любая нода			|План запроса					| —					|
|Shard				|Логическая сущность|Горизонтальное масштабирование	| —					|
|Replica			|Нода				|Отказоустойчивость				| —					|
|ZooKeeper			|Отдельный сервис	|Координация, метаданные		|2181 / 2888 / 3888	|
|Client				|Внешний			|Отправка запросов				|9000 / 8123		|

# Ссылки
1. Официальная документация\
Install ClickHouse on Debian/Ubuntu\
https://clickhouse.com/docs/install?ysclid=mkzsgud2sc374410174

2. ChatGPT



# Роли и компоненты

В ClickHouse важно сразу выкинуть «hadoop-мышление»: формальных master / worker ролей почти нет. Почти каждая нода — и сервер, и координатор.\
ClickHouse Server (часто называют «master-нода») - на самом деле все ClickHouse-ноды равноправны.

----------------------------------------------
1. ClickHouse Server — это универсальный узел, который одновременно может быть:
	* координатором запроса
	* хранителем данных
	* репликой
	* участником DDL ON CLUSTER
	* участником distributed insert/select


Нет выделенного master-а, любая нода может:\
	* принять запрос от клиента\
	* разослать подзапросы по кластеру\
	* агрегировать результат


Основные функции:\
	* Хранение данных (MergeTree, ReplicatedMergeTree)\
	* Выполнение SQL\
	* Межнодовое взаимодействие\
	* Репликация (через ZooKeeper)\
	* Distributed tables\
	* DDL ON CLUSTER

Порты ClickHouse Server

| Порт	| Назначение													|Протокол	|
|-------|---------------------------------------------------------------|-----------|
|9000	|Native client / server / distributed - основной «рабочий» порт	|TCP		|
|8123	|HTTP API - часто нужен BI / curl / REST						|HTTP		|
|9009	|Interserver (критичен для репликации)							|HTTP		|
|9440	|HTTPS (если включён)											|HTTPS		|


Роль определяется конфигурацией и запросом, а не типом ноды, пример:\
	* ты подключился к ch-master-1\
	* сделал SELECT FROM events_dist\
	* ch-master-1 стал координатором\
	* остальные — исполнителями

----------------------------------------------
2. Zookeeper - только для HA-кластеров с несколькими NN!\
Роль: это централизованный сервис для координации распределённых приложений. Он нужен для:
  * Хранения конфигураций — безопасное централизованное хранилище, доступное всем узлам.
  * Управления состоянием — помогает синхронизировать состояния между разными компонентами кластера.
  * Выборов лидера — например, чтобы один из узлов стал активным мастером.
  * Блокировок и согласования — обеспечивает механизмы распределённой блокировки и уведомлений о событиях.

